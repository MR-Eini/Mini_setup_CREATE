## Cleaning calculation directory
file.remove(paste0(in_dir, "/", files))
##------------------------------------------------------------------------------
## 10) Additional editing of the farmR_input.csv file
##------------------------------------------------------------------------------
#
## Reading the file
mgt <- paste0(out_dir, "/farmR_input.csv")
mgt_file <- read.csv(mgt)
## Updating farmR_input.csv for providing management schedules in drained areas
mgt_file <- bind_rows(mgt_file, mgt_file %>%
mutate(land_use = gsub("_lum", "_drn_lum", land_use)))
write_csv(mgt_file, file = mgt, quote = "needed", na = '')
## Overwriting plants.plt with adjusted manually
file.copy(paste0(lib_path, "/files_to_overwrite_at_the_end/plants.plt"), dir_path,
overwrite = TRUE)
## Setting directory and running Micha's SWAtfarmR'er input script
in_dir <- paste0(lib_path, "/farmR_input")
source(paste0(in_dir, "/write_SWATfarmR_input.R"), chdir=TRUE)
## Coping results into results folder
files <- list.files(in_dir, pattern = "\\.csv$")
out_dir <- paste0(res_path, "/farmR_input")
if (dir.exists(out_dir)) unlink(out_dir, recursive = TRUE)
dir.create(out_dir)
file.copy(paste0(in_dir, "/", files), paste0(res_path, "/farmR_input"))
## Cleaning calculation directory
file.remove(paste0(in_dir, "/", files))
## Backing up landuse.lum file
if(!file.exists(paste0(dir_path, "/", "landuse.lum.bak"))) {
file.copy(from = paste0(dir_path, "/", "landuse.lum"),
to = paste0(dir_path, "/", "landuse.lum", ".bak"), overwrite = TRUE)
}
## Updating it
source(paste0(lib_path, '/read_and_modify_landuse_lum.R'))
## Soil P data mapping and adding to model files scripts are provided by WP3.
## Please utilize WPs&Task>WP3>Scrips and tools> App8_Map_soilP_content.R and
## App9_Add_soilP_content_to_HRU.r
## Following lines provide way to update single value in nutrients.sol file
## Updating single value of labile phosphorus in nutrients.sol
f_write <- paste0(dir_path, "/", "nutrients.sol")
nutrients.sol <- read.delim(f_write)
nutrients.sol[2,1] <- gsub("5.00000", lab_p, nutrients.sol[2,1])
update_file(nutrients.sol, f_write)
##Including connecting nutrients.sol into hru-data.hru
if(!file.exists(paste0(dir_path, '/hru-data.hru.bkp0'))) {
copy_file_version(dir_path, 'hru-data.hru', file_version = 0)
}
hru_data <- SWATtunR::read_tbl(paste0(dir_path, "/hru-data.hru.bkp0"))
hru_data$soil_plant_init <- "soilplant1"
hru_data_fmt <- c('%8s', '%-14s', rep('%18s', 8))
SWATreadR:::write_tbl(hru_data, paste0(dir_path, '/hru-data.hru'), fmt = hru_data_fmt)
# install.packages("remotes")
# install.packages("RNetCDF")
# install.packages("tidyverse")
# remotes::install_github("biopsichas/SWATtunR")
# remotes::install_github("biopsichas/SWATprepR")
# remotes::install_github("tkdweber/euptf2")
# remotes::install_github("chrisschuerz/SWATfarmR")
# remotes::install_github("chrisschuerz/SWATrunR@remove_legacy")
# remotes::install_github("biopsichas/SWATdoctR")
# remotes::install_github('chrisschuerz/SWATmeasR')
remotes::install_github('chrisschuerz/SWATreadR')
## Updating single value of labile phosphorus in nutrients.sol
f_write <- paste0(dir_path, "/", "nutrients.sol")
nutrients.sol <- read.delim(f_write)
nutrients.sol[2,1] <- gsub("5.00000", lab_p, nutrients.sol[2,1])
update_file(nutrients.sol, f_write)
##Including connecting nutrients.sol into hru-data.hru
if(!file.exists(paste0(dir_path, '/hru-data.hru.bkp0'))) {
copy_file_version(dir_path, 'hru-data.hru', file_version = 0)
}
hru_data <- SWATtunR::read_tbl(paste0(dir_path, "/hru-data.hru.bkp0"))
hru_data$soil_plant_init <- "soilplant1"
hru_data_fmt <- c('%8s', '%-14s', rep('%18s', 8))
SWATreadR:::write_tbl(hru_data, paste0(dir_path, '/hru-data.hru'), fmt = hru_data_fmt)
## Reading time.sim
f_write <- paste0(dir_path, "/", "time.sim")
time_sim <- read.delim(f_write)
## Updating with values provided in settings
y <- as.numeric(unlist(strsplit(time_sim[2,1], "\\s+"))[-1])
if(min(y[y>0]) != st_year){
time_sim[2,1] <- gsub(min(y[y>0]), st_year, time_sim[2,1])
}
if(max(y[y>0]) != end_year){
time_sim[2,1] <- gsub(max(y[y>0]), end_year, time_sim[2,1])
}
##Writing out updated time.sim file
update_file(time_sim, f_write)
source(paste0(lib_path, '/create_connectivity_line_shape.R'))
print(paste0("land_connections_as_lines.shp is prepared in ", dir_path,
'/data folder' ))
##Copy swat.exe into txtinout directory and run it
exe_copy_run(lib_path, dir_path, swat_exe)
## Adding missing fertilizers and tillage
if(!file.exists(paste0(dir_path, '/fertilizer.frt.bkp0'))) {
copy_file_version(dir_path, 'fertilizer.frt', file_version = 0)
}
fertilizer.frt <- SWATtunR::read_tbl(paste0(dir_path, "/fertilizer.frt.bkp0"))
fertilizer.frt[nrow(fertilizer.frt)+1,] <- list("comp_manure", 0.0021, 0.0016, 0.0017, 0.008, 0.99, "fresh_manure", "Comp_FreshManure")
fertilizer.frt[nrow(fertilizer.frt)+1,] <- list("7:20:30", 0.02, 0.08728, 0, 0, 0, "null", "NPK")
fertilizer_frt_fmt <- c('%-18s', rep('%12s', 5), '%18s', '%-30s')
SWATreadR:::write_tbl(fertilizer.frt, paste0(dir_path, '/fertilizer.frt'), fmt = fertilizer_frt_fmt)
if(!file.exists(paste0(dir_path, '/tillage.til.bak0'))) {
copy_file_version(dir_path, 'tillage.til', file_version = 0)
}
tillage.til <- SWATtunR::read_tbl(paste0(dir_path, "/tillage.til.bkp0"))
tillage.til[nrow(tillage.til )+1,] <- list("plow25", 0.95, 250, 75, 0, 0, "plowingoperation25cm")
tillage_til_fmt <- c('%-18s', rep('%12s', 5), '%-40s')
SWATreadR:::write_tbl(tillage.til, paste0(dir_path, '/tillage.til'), fmt = tillage_til_fmt)
## Generating .farm project
if(startsWith(as.character(packageVersion("SWATfarmR")), "4.")){
frm <- SWATfarmR::farmr_project$new(project_name = 'frm', project_path = dir_path,
project_type = 'environment')
.GlobalEnv$frm <- frm
} else if(startsWith(as.character(packageVersion("SWATfarmR")), "3.2.0")){
frm <- SWATfarmR::farmr_project$new(project_name = 'frm', project_path = dir_path)
} else {
stop("SWATfarmR version should be > 4.0.0 or special version 3.2.0
from OPTAIN Cloud>WPs&Tasks>WP4>Task4.4>Tools to share>workflow_scripts>SWATfarmR_3.2.0.zip")
}
## Adding dependence to precipitation
api <- variable_decay(frm$.data$variables$pcp, -5,0.8)
asgn <- select(frm$.data$meta$hru_var_connect, hru, pcp)
frm$add_variable(api, "api", asgn)
## Reading schedules, scheduling operations and writing management files
frm$read_management(mgt, discard_schedule = TRUE)
frm$schedule_operations(start_year = 1995, end_year = 2021,
replace = 'all')
------------------------------------------------------------------------
## Please read https://chrisschuerz.github.io/SWATfarmR/ to understand how to
## apply this tool. Below are a minimal set of lines to access management files.
## However, these might not be suitable in your case. Review before using
## Adding missing fertilizers and tillage
if(!file.exists(paste0(dir_path, '/fertilizer.frt.bkp0'))) {
copy_file_version(dir_path, 'fertilizer.frt', file_version = 0)
}
## Adding missing fertilizers and tillage
if(!file.exists(paste0(dir_path, '/fertilizer.frt.bkp0'))) {
copy_file_version(dir_path, 'fertilizer.frt', file_version = 0)
}
fertilizer.frt <- SWATtunR::read_tbl(paste0(dir_path, "/fertilizer.frt.bkp0"))
fertilizer.frt[nrow(fertilizer.frt)+1,] <- list("comp_manure", 0.0021, 0.0016, 0.0017, 0.008, 0.99, "fresh_manure", "Comp_FreshManure")
fertilizer.frt[nrow(fertilizer.frt)+1,] <- list("7:20:30", 0.02, 0.08728, 0, 0, 0, "null", "NPK")
fertilizer_frt_fmt <- c('%-18s', rep('%12s', 5), '%18s', '%-30s')
SWATreadR:::write_tbl(fertilizer.frt, paste0(dir_path, '/fertilizer.frt'), fmt = fertilizer_frt_fmt)
if(!file.exists(paste0(dir_path, '/tillage.til.bak0'))) {
copy_file_version(dir_path, 'tillage.til', file_version = 0)
}
tillage.til <- SWATtunR::read_tbl(paste0(dir_path, "/tillage.til.bkp0"))
tillage.til[nrow(tillage.til )+1,] <- list("plow25", 0.95, 250, 75, 0, 0, "plowingoperation25cm")
tillage_til_fmt <- c('%-18s', rep('%12s', 5), '%-40s')
SWATreadR:::write_tbl(tillage.til, paste0(dir_path, '/tillage.til'), fmt = tillage_til_fmt)
## Generating .farm project
if(startsWith(as.character(packageVersion("SWATfarmR")), "4.")){
frm <- SWATfarmR::farmr_project$new(project_name = 'frm', project_path = dir_path,
project_type = 'environment')
.GlobalEnv$frm <- frm
} else if(startsWith(as.character(packageVersion("SWATfarmR")), "3.2.0")){
frm <- SWATfarmR::farmr_project$new(project_name = 'frm', project_path = dir_path)
} else {
stop("SWATfarmR version should be > 4.0.0 or special version 3.2.0
from OPTAIN Cloud>WPs&Tasks>WP4>Task4.4>Tools to share>workflow_scripts>SWATfarmR_3.2.0.zip")
}
## Generating .farm project
if(startsWith(as.character(packageVersion("SWATfarmR")), "4.")){
frm <- SWATfarmR::farmr_project$new(project_name = 'frm', project_path = dir_path,
project_type = 'environment')
.GlobalEnv$frm <- frm
} else if(startsWith(as.character(packageVersion("SWATfarmR")), "3.2.0")){
frm <- SWATfarmR::farmr_project$new(project_name = 'frm', project_path = dir_path)
} else {
stop("SWATfarmR version should be > 4.0.0 or special version 3.2.0
from OPTAIN Cloud>WPs&Tasks>WP4>Task4.4>Tools to share>workflow_scripts>SWATfarmR_3.2.0.zip")
}
## Adding dependence to precipitation
api <- variable_decay(frm$.data$variables$pcp, -5,0.8)
asgn <- select(frm$.data$meta$hru_var_connect, hru, pcp)
frm$add_variable(api, "api", asgn)
## Reading schedules, scheduling operations and writing management files
frm$read_management(mgt, discard_schedule = TRUE)
frm$schedule_operations(start_year = 1995, end_year = 2021,
replace = 'all')
rlang::last_trace()
met_int <- interpolate(met, "Data/for_buildr/basin.shp",
"Data/for_buildr/DEM.tif", 5000)
met_int <- SWATprepR::interpolate(met, "Data/for_buildr/basin.shp",
"Data/for_buildr/DEM.tif", 5000)
met_int <- SWATprepR::interpolate(met, basin_path, DEM_path,, 5000)
library(mapview)
install.packages("mapview")
install.packages("sf")
# install.packages("remotes")
# install.packages("RNetCDF")
# install.packages("tidyverse")
install.packages("mapview")
install.packages("dplyr")
met <- load_template(weather_path, 2180)
met <- load_template(weather_path, 2180)
##------------------------------------------------------------------------------
## General settings
##------------------------------------------------------------------------------
## SWAT+ model file name to be used in workflow (should be in 'Libraries' folder)
swat_exe <- "SWATp_jan_sept.exe"
## Folder names
## Folder for saving results
res_path <- "Temp_"
## Data folder
data_path <- "Data"
## Scripts folder
lib_path <- "Libraries"
##Starting year for model setup
st_year <-  1995
##End year for the model setup
end_year <- 2021
## Paths to input data
## Path to weather data
## Description of functions and how data example was prepared is on this webpage
## https://biopsichas.github.io/SWATprepR/articles/weather.html
weather_path <- paste0(data_path, '/for_prepr/weather_data_mini_model.xlsx')
## Path to point data
## Description of functions and how data example was prepared is on this webpage
## https://biopsichas.github.io/SWATprepR/articles/psources.html
# pnt_path <- paste0(data_path, '/for_prepr/pnt_data.xlsx')
## Other settings
## For scripts to get to work directory of setup_workflow.R
out_path <- "../../"
## Soluble phosphorus to be written in nutrients.sol (current version of
## workflow changes singe value for all catchment)
lab_p <- "40.4000"
##------------------------------------------------------------------------------
## SWATbuilder settings
##------------------------------------------------------------------------------
buildr_data <- paste0(data_path, "/for_buildr/")
# Set input/output paths -------------------------------------------
#
# Project path (where output files are saved) ----------------------
project_path <- paste0(out_path, res_path, '/buildr_project')
project_name <- 'Mini_CREATE'
# Path of the TxtInOut folder (project folder where the SWAT+ text
# files are written with the SWAT+Editor)
txt_path <- paste0(project_path, "/", project_name, "/txt")
# Input data -------------------------------------------------------
## DEM raster layer path
dem_path <- paste0(out_path, buildr_data, 'DEM1.tif')
##Soil raster layer and soil tables paths
soil_layer_path  <- paste0(out_path, buildr_data, 'soil1.tif')
soil_lookup_path <- paste0(out_path, buildr_data, 'Soil_SWAT_cod.csv')
soil_data_path   <- paste0(out_path, buildr_data, 'usersoil_lrew.csv')
## Land input vector layer path
# land_path <- paste0(out_path, buildr_data, 'land.shp')
land_path <- paste0(out_path, buildr_data, 'land1.shp')
## Channel input vector layer path
channel_path <- paste0(out_path, buildr_data, 'river1.shp')
# channel_path <- paste0(out_path, buildr_data, "Pesnica_full_streams_reduced.shp")
## Catchment boundary vector layer path, all layers will be masked by the
## basin boundary
basin_path <- bound_path <- paste0(out_path, buildr_data, 'basin1.shp')
## Path to point source location layer
point_path <- NULL
# point_path <- paste0(out_path, buildr_data, 'WWTP.shp')
# Settings ---------------------------------------------------------
## Project layers
## The input layers might be in different coordinate reference systems (CRS).
## It is recommended to project all layers to the same CRS and check them
## before using them as model inputs. The model setup process checks if
## the layer CRSs differ from the one of the basin boundary. By setting
## 'proj_layer <- TRUE' the layer is projected if the CRS is different.
## If FALSE different CRS trigger an error.
project_layer <- TRUE
## Set the outlet point of the catchment
## Either define a channel OR a reservoir as the final outlet
## If channel then assign id_cha_out with the respective id from the
## channel layer:
id_cha_out <- 5
## If reservoir then assign the respective id from the land layer to
##  id_res_out, otherwise leave as set
id_res_out <- NULL
## Threshold to eliminate land object connectivities with flow fractions
## lower than 'frc_thres'. This is necessary to i) simplify the connectivity
## network, and ii) to reduce the risk of circuit routing between land
## objects. Circuit routing will be checked. If an error due to circuit
## routing is triggered, then 'frc_thres' must be increased to remove
## connectivities that may cause this issue.
frc_thres <- 0.4
## Define wetland land uses. Default the wetland land uses from the SWAT+
## plants.plt data base are defined as wetland land uses. Wetland land uses
## should only be changed by the user if individual wetland land uses were
## defined in the plant data base.
wetland_landuse <- c('wehb', 'wetf', 'wetl', 'wetn')
## Maximum distance of a point source to a channel or a reservoir to be included
## as a point source object (recall) in the model setup
max_point_dist <- 500 #meters
##------------------------------------------------------------------------------
## SWATfarmR'er input script settings
##------------------------------------------------------------------------------
farmr_i_data <- paste0(data_path, "/for_farmr_input/")
# Define input files------------------------------------------------------------
# land-use crop map shapefile
##### IMPORTANT: if the agrl has drainage: agrl142 should be agrl142_drn in type
lu_shp <- paste0(out_path, farmr_i_data, 'crops1.shp')
# crop management .csv table
mgt_csv <- paste0(out_path, farmr_i_data, 'mgt_crops.csv')
# generic land use management .csv table
lu_generic_csv <- paste0(out_path, farmr_i_data, 'mgt_generic.csv')
## Simulation period
start_y <- st_year #starting year (consider at least 3 years for warm-up!)
end_y <- end_year #ending year
## Prefix of cropland hrus (all names of hrus with a crop rotation must begin
## with this prefix in column 'lu' of your land use map)
hru_crops <- 'agrl'
## Multi-year farmland grass
## Did you define any multi-year farmland grass schedules? 'y' (yes), 'n' (no)
m_yr_sch_existing <- 'n'
## If yes, define also the following variables. If not, skip next four lines
crop_myr <- 'fesc' # prefix of multi-year schedules in management file
## multiple entries should have the same number of characters,
## e.g.: crop_myr <- c('akgs', 'bsvg')
max_yr <- 4 # maximum number of years farmland grass can grow before it is
## killed (should be <8)
## Do your multi-year farmland grass schedules consider the type of the
## following crop (summer or winter crop)? (e.g., a '_1.5yr' schedule with a
## kill op in spring allows for planting a summer crop immediately afterwards)
## If yes, you must define your summer crops
crop_s <- c('corn','csil','soyb')
## Do your summer crop schedules usually start with an operation in autumn
## (e.g. tillage)? To combine them with farmland grass, it is necessary that you
## provide 'half-year-schedules' ('half-year-schedules' are additional summer
## crop schedules without operations in autumn) The adapted schedules should be
## added to the crop management table with suffix '_0.5yr' (e.g. 'csil_0.5yr')
## If additional 'half-year-schedules' are not needed, because your normal
## summer crop schedules do not start in autumn, type 'n'
additional_h_yr_sch_existing <- 'n' # 'y' (yes), 'n' (no)
met <- load_template(weather_path, 2180)
library(SWATprepR)
library(SWATfarmR)
library(SWATtunR)
library(SWATdoctR)
library(mapview)
library(sf)
library(dplyr)
source('settings.R')
source('functions.R')
met <- load_template(weather_path, 2180)
met_int <- SWATprepR::interpolate(met, basin_path, DEM_path,, 1000)
## Catchment boundary vector layer path, all layers will be masked by the
## basin boundary
basin_path <- bound_path <- paste0(out_path, buildr_data, 'basin1.shp')
met_int <- SWATprepR::interpolate(met, "Data/for_buildr/basin1.shp",
"Data/for_buildr/DEM1.tif", 1000)
install.packages("gstat")
met_int <- SWATprepR::interpolate(met, "Data/for_buildr/basin1.shp",
"Data/for_buildr/DEM1.tif", 1000)
met_int <- SWATprepR::interpolate(met, "Data/for_buildr/basin1.shp",
"Data/for_buildr/DEM1.tif", 10000)
##------------------------------------------------------------------------------
## General settings
##------------------------------------------------------------------------------
## SWAT+ model file name to be used in workflow (should be in 'Libraries' folder)
swat_exe <- "SWATp_jan_sept.exe"
## Folder names
## Folder for saving results
res_path <- "Temp_"
## Data folder
data_path <- "Data"
## Scripts folder
lib_path <- "Libraries"
##Starting year for model setup
st_year <-  1995
##End year for the model setup
end_year <- 2021
## Paths to input data
## Path to weather data
## Description of functions and how data example was prepared is on this webpage
## https://biopsichas.github.io/SWATprepR/articles/weather.html
# weather_path <- paste0(data_path, '/for_prepr/weather_data_mini_model.xlsx')
weather_path <- paste0(data_path, '/for_prepr/met_int_mini_model.rds')
## Path to point data
## Description of functions and how data example was prepared is on this webpage
## https://biopsichas.github.io/SWATprepR/articles/psources.html
# pnt_path <- paste0(data_path, '/for_prepr/pnt_data.xlsx')
## Other settings
## For scripts to get to work directory of setup_workflow.R
out_path <- "../../"
## Soluble phosphorus to be written in nutrients.sol (current version of
## workflow changes singe value for all catchment)
lab_p <- "40.4000"
##------------------------------------------------------------------------------
## SWATbuilder settings
##------------------------------------------------------------------------------
buildr_data <- paste0(data_path, "/for_buildr/")
# Set input/output paths -------------------------------------------
#
# Project path (where output files are saved) ----------------------
project_path <- paste0(out_path, res_path, '/buildr_project')
project_name <- 'Mini_CREATE'
# Path of the TxtInOut folder (project folder where the SWAT+ text
# files are written with the SWAT+Editor)
txt_path <- paste0(project_path, "/", project_name, "/txt")
# Input data -------------------------------------------------------
## DEM raster layer path
dem_path <- paste0(out_path, buildr_data, 'DEM1.tif')
##Soil raster layer and soil tables paths
soil_layer_path  <- paste0(out_path, buildr_data, 'soil1.tif')
soil_lookup_path <- paste0(out_path, buildr_data, 'Soil_SWAT_cod.csv')
soil_data_path   <- paste0(out_path, buildr_data, 'usersoil_lrew.csv')
## Land input vector layer path
# land_path <- paste0(out_path, buildr_data, 'land.shp')
land_path <- paste0(out_path, buildr_data, 'land1.shp')
## Channel input vector layer path
channel_path <- paste0(out_path, buildr_data, 'river1.shp')
# channel_path <- paste0(out_path, buildr_data, "Pesnica_full_streams_reduced.shp")
## Catchment boundary vector layer path, all layers will be masked by the
## basin boundary
basin_path <- bound_path <- paste0(out_path, buildr_data, 'basin1.shp')
## Path to point source location layer
point_path <- NULL
# point_path <- paste0(out_path, buildr_data, 'WWTP.shp')
# Settings ---------------------------------------------------------
## Project layers
## The input layers might be in different coordinate reference systems (CRS).
## It is recommended to project all layers to the same CRS and check them
## before using them as model inputs. The model setup process checks if
## the layer CRSs differ from the one of the basin boundary. By setting
## 'proj_layer <- TRUE' the layer is projected if the CRS is different.
## If FALSE different CRS trigger an error.
project_layer <- TRUE
## Set the outlet point of the catchment
## Either define a channel OR a reservoir as the final outlet
## If channel then assign id_cha_out with the respective id from the
## channel layer:
id_cha_out <- 5
## If reservoir then assign the respective id from the land layer to
##  id_res_out, otherwise leave as set
id_res_out <- NULL
## Threshold to eliminate land object connectivities with flow fractions
## lower than 'frc_thres'. This is necessary to i) simplify the connectivity
## network, and ii) to reduce the risk of circuit routing between land
## objects. Circuit routing will be checked. If an error due to circuit
## routing is triggered, then 'frc_thres' must be increased to remove
## connectivities that may cause this issue.
frc_thres <- 0.4
## Define wetland land uses. Default the wetland land uses from the SWAT+
## plants.plt data base are defined as wetland land uses. Wetland land uses
## should only be changed by the user if individual wetland land uses were
## defined in the plant data base.
wetland_landuse <- c('wehb', 'wetf', 'wetl', 'wetn')
## Maximum distance of a point source to a channel or a reservoir to be included
## as a point source object (recall) in the model setup
max_point_dist <- 500 #meters
##------------------------------------------------------------------------------
## SWATfarmR'er input script settings
##------------------------------------------------------------------------------
farmr_i_data <- paste0(data_path, "/for_farmr_input/")
# Define input files------------------------------------------------------------
# land-use crop map shapefile
##### IMPORTANT: if the agrl has drainage: agrl142 should be agrl142_drn in type
lu_shp <- paste0(out_path, farmr_i_data, 'crops1.shp')
# crop management .csv table
mgt_csv <- paste0(out_path, farmr_i_data, 'mgt_crops.csv')
# generic land use management .csv table
lu_generic_csv <- paste0(out_path, farmr_i_data, 'mgt_generic.csv')
## Simulation period
start_y <- st_year #starting year (consider at least 3 years for warm-up!)
end_y <- end_year #ending year
## Prefix of cropland hrus (all names of hrus with a crop rotation must begin
## with this prefix in column 'lu' of your land use map)
hru_crops <- 'agrl'
## Multi-year farmland grass
## Did you define any multi-year farmland grass schedules? 'y' (yes), 'n' (no)
m_yr_sch_existing <- 'n'
## If yes, define also the following variables. If not, skip next four lines
crop_myr <- 'fesc' # prefix of multi-year schedules in management file
## multiple entries should have the same number of characters,
## e.g.: crop_myr <- c('akgs', 'bsvg')
max_yr <- 4 # maximum number of years farmland grass can grow before it is
## killed (should be <8)
## Do your multi-year farmland grass schedules consider the type of the
## following crop (summer or winter crop)? (e.g., a '_1.5yr' schedule with a
## kill op in spring allows for planting a summer crop immediately afterwards)
## If yes, you must define your summer crops
crop_s <- c('corn','csil','soyb')
## Do your summer crop schedules usually start with an operation in autumn
## (e.g. tillage)? To combine them with farmland grass, it is necessary that you
## provide 'half-year-schedules' ('half-year-schedules' are additional summer
## crop schedules without operations in autumn) The adapted schedules should be
## added to the crop management table with suffix '_0.5yr' (e.g. 'csil_0.5yr')
## If additional 'half-year-schedules' are not needed, because your normal
## summer crop schedules do not start in autumn, type 'n'
additional_h_yr_sch_existing <- 'n' # 'y' (yes), 'n' (no)
# Or rds file
met <- readRDS(weather_path, 2180)
## Calculating weather generator statistics
wgn <- prepare_wgn(met)
# Or rds file (already interpolated)
met <- readRDS(weather_path, 2180)
## Calculating weather generator statistics
wgn <- prepare_wgn(met)
## Adding weather and atmospheric deposition data into setup
add_weather(db_path, met, wgn)
library(SWATprepR)
library(SWATfarmR)
library(SWATtunR)
library(SWATdoctR)
library(mapview)
library(sf)
library(dplyr)
source('settings.R')
source('functions.R')
## If the directory exists, delete the results directory. (Please be careful!!!)
if (file.exists(res_path)) unlink(res_path, recursive = TRUE)
## Creating results directory
dir.create(res_path, recursive = TRUE)
